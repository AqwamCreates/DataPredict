local zTableFunction = {}

local zTable = {

	["-3.9"] = {

		["-0.00"] = 0.00005,
		["-0.01"] = 0.00005,
		["-0.02"] = 0.00004,
		["-0.03"] = 0.00004,
		["-0.04"] = 0.00004,
		["-0.05"] = 0.00004,
		["-0.06"] = 0.00004,
		["-0.07"] = 0.00004,
		["-0.08"] = 0.00003,
		["-0.09"] = 0.00003,

	},

	["-3.8"] = {

		["-0.00"] = 0.00007,
		["-0.01"] = 0.00007,
		["-0.02"] = 0.00007,
		["-0.03"] = 0.00006,
		["-0.04"] = 0.00006,
		["-0.05"] = 0.00006,
		["-0.06"] = 0.00006,
		["-0.07"] = 0.00005,
		["-0.08"] = 0.00005,
		["-0.09"] = 0.00005,

	},

	["-3.7"] = {

		["-0.00"] = 0.00011,
		["-0.01"] = 0.00010,
		["-0.02"] = 0.00010,
		["-0.03"] = 0.00010,
		["-0.04"] = 0.00009,
		["-0.05"] = 0.00009,
		["-0.06"] = 0.00008,
		["-0.07"] = 0.00008,
		["-0.08"] = 0.00008,
		["-0.09"] = 0.00008,


	},

	["-3.6"] = {

		["-0.00"] = 0.00016,
		["-0.01"] = 0.00015,
		["-0.02"] = 0.00015,
		["-0.03"] = 0.00014,
		["-0.04"] = 0.00014,
		["-0.05"] = 0.00013,
		["-0.06"] = 0.00013,
		["-0.07"] = 0.00012,
		["-0.08"] = 0.00012,
		["-0.09"] = 0.00011,

	},

	["-3.5"] = {

		["-0.00"] = 0.00023,
		["-0.01"] = 0.00022,
		["-0.02"] = 0.00022,
		["-0.03"] = 0.00021,
		["-0.04"] = 0.00020,
		["-0.05"] = 0.00019,
		["-0.06"] = 0.00019,
		["-0.07"] = 0.00018,
		["-0.08"] = 0.00017,
		["-0.09"] = 0.00017,

	},

	["-3.4"] = {

		["-0.00"] = 0.00034,
		["-0.01"] = 0.00032,
		["-0.02"] = 0.00031,
		["-0.03"] = 0.00030,
		["-0.04"] = 0.00029,
		["-0.05"] = 0.00028,
		["-0.06"] = 0.00027,
		["-0.07"] = 0.00026,
		["-0.08"] = 0.00025,
		["-0.09"] = 0.00024,

	},

	["-3.3"] = {

		["-0.00"] = 0.00048,
		["-0.01"] = 0.00047,
		["-0.02"] = 0.00045,
		["-0.03"] = 0.00043,
		["-0.04"] = 0.00042,
		["-0.05"] = 0.00040,
		["-0.06"] = 0.00039,
		["-0.07"] = 0.00038,
		["-0.08"] = 0.00036,
		["-0.09"] = 0.00035,

	},

	["-3.2"] = {

		["-0.00"] = 0.00069,
		["-0.01"] = 0.00066,
		["-0.02"] = 0.00064,
		["-0.03"] = 0.00062,
		["-0.04"] = 0.00060,
		["-0.05"] = 0.00058,
		["-0.06"] = 0.00056,
		["-0.07"] = 0.00054,
		["-0.08"] = 0.00052,
		["-0.09"] = 0.00050,

	},

	["-3.1"] = {

		["-0.00"] = 0.00097,
		["-0.01"] = 0.00094,
		["-0.02"] = 0.00090,
		["-0.03"] = 0.00087,
		["-0.04"] = 0.00084,
		["-0.05"] = 0.00082,
		["-0.06"] = 0.00079,
		["-0.07"] = 0.00076,
		["-0.08"] = 0.00074,
		["-0.09"] = 0.00071,

	},

	["-3.0"] = {

		["-0.00"] = 0.00135,
		["-0.01"] = 0.00131,
		["-0.02"] = 0.00126,
		["-0.03"] = 0.00122,
		["-0.04"] = 0.00118,
		["-0.05"] = 0.00114,
		["-0.06"] = 0.00111,
		["-0.07"] = 0.00107,
		["-0.08"] = 0.00104,
		["-0.09"] = 0.00100,

	},

	["-2.9"] = {

		["-0.00"] = 0.00187,
		["-0.01"] = 0.00181,
		["-0.02"] = 0.00175,
		["-0.03"] = 0.00169,
		["-0.04"] = 0.00164,
		["-0.05"] = 0.00159,
		["-0.06"] = 0.00154,
		["-0.07"] = 0.00149,
		["-0.08"] = 0.00144,
		["-0.09"] = 0.00139,

	},

	["-2.8"] = {

		["-0.00"] = 0.00256,
		["-0.01"] = 0.00248,
		["-0.02"] = 0.00240,
		["-0.03"] = 0.00233,
		["-0.04"] = 0.00226,
		["-0.05"] = 0.00219,
		["-0.06"] = 0.00212,
		["-0.07"] = 0.00205,
		["-0.08"] = 0.00199,
		["-0.09"] = 0.00193,

	},

	["-2.7"] = {

		["-0.00"] = 0.00347,
		["-0.01"] = 0.00336,
		["-0.02"] = 0.00326,
		["-0.03"] = 0.00317,
		["-0.04"] = 0.00307,
		["-0.05"] = 0.00298,
		["-0.06"] = 0.00289,
		["-0.07"] = 0.00280,
		["-0.08"] = 0.00272,
		["-0.09"] = 0.00264,
	},

	["-2.6"] = {
		["-0.00"] = 0.00466,
		["-0.01"] = 0.00453,
		["-0.02"] = 0.00440,
		["-0.03"] = 0.00427,
		["-0.04"] = 0.00415,
		["-0.05"] = 0.00402,
		["-0.06"] = 0.00391,
		["-0.07"] = 0.00379,
		["-0.08"] = 0.00368,
		["-0.09"] = 0.00357,
	},

	["-2.5"] = {
		["-0.00"] = 0.00621,
		["-0.01"] = 0.00604,
		["-0.02"] = 0.00587,
		["-0.03"] = 0.00570,
		["-0.04"] = 0.00554,
		["-0.05"] = 0.00539,
		["-0.06"] = 0.00523,
		["-0.07"] = 0.00508,
		["-0.08"] = 0.00494,
		["-0.09"] = 0.00480,
	},

	["-2.4"] = {

		["-0.00"] = 0.00820,
		["-0.01"] = 0.00798,
		["-0.02"] = 0.00776,
		["-0.03"] = 0.00755,
		["-0.04"] = 0.00734,
		["-0.05"] = 0.00714,
		["-0.06"] = 0.00695,
		["-0.07"] = 0.00676,
		["-0.08"] = 0.00657,
		["-0.09"] = 0.00639,

	},

	["-2.3"] = {

		["-0.00"] = 0.01072,
		["-0.01"] = 0.01044,
		["-0.02"] = 0.01017,
		["-0.03"] = 0.00990,
		["-0.04"] = 0.00964,
		["-0.05"] = 0.00939,
		["-0.06"] = 0.00914,
		["-0.07"] = 0.00889,
		["-0.08"] = 0.00866,
		["-0.09"] = 0.00842,

	},

	["-2.2"] = {

		["-0.00"] = 0.01390,
		["-0.01"] = 0.01355,
		["-0.02"] = 0.01321,
		["-0.03"] = 0.01287,
		["-0.04"] = 0.01255,
		["-0.05"] = 0.01222,
		["-0.06"] = 0.01191,
		["-0.07"] = 0.01160,
		["-0.08"] = 0.01130,
		["-0.09"] = 0.01101,

	},

	["-2.1"] = {

		["-0.00"] = 0.01786,
		["-0.01"] = 0.01743,
		["-0.02"] = 0.01700,
		["-0.03"] = 0.01659,
		["-0.04"] = 0.01618,
		["-0.05"] = 0.01578,
		["-0.06"] = 0.01539,
		["-0.07"] = 0.01500,
		["-0.08"] = 0.01463,
		["-0.09"] = 0.01426,

	},

	["-2.0"] = {

		["-0.00"] = 0.02275,
		["-0.01"] = 0.02222,
		["-0.02"] = 0.02169,
		["-0.03"] = 0.02118,
		["-0.04"] = 0.02068,
		["-0.05"] = 0.02018,
		["-0.06"] = 0.01970,
		["-0.07"] = 0.01923,
		["-0.08"] = 0.01876,
		["-0.09"] = 0.01831,

	},

	["-1.9"] = {

		["-0.00"] = 0.02872,
		["-0.01"] = 0.02807,
		["-0.02"] = 0.02743,
		["-0.03"] = 0.02680,
		["-0.04"] = 0.02619,
		["-0.05"] = 0.02559,
		["-0.06"] = 0.02500,
		["-0.07"] = 0.02442,
		["-0.08"] = 0.02385,
		["-0.09"] = 0.02330,

	},

	["-1.8"] = {

		["-0.00"] = 0.03593,
		["-0.01"] = 0.03515,
		["-0.02"] = 0.03438,
		["-0.03"] = 0.03362,
		["-0.04"] = 0.03288,
		["-0.05"] = 0.03216,
		["-0.06"] = 0.03144,
		["-0.07"] = 0.03074,
		["-0.08"] = 0.03005,
		["-0.09"] = 0.02938,

	},

	["-1.7"] = {

		["-0.00"] = 0.04457,
		["-0.01"] = 0.04363,
		["-0.02"] = 0.04272,
		["-0.03"] = 0.04182,
		["-0.04"] = 0.04093,
		["-0.05"] = 0.04006,
		["-0.06"] = 0.03920,
		["-0.07"] = 0.03836,
		["-0.08"] = 0.03754,
		["-0.09"] = 0.03673,

	},

	["-1.6"] = {

		["-0.00"] = 0.05480,
		["-0.01"] = 0.05370,
		["-0.02"] = 0.05262,
		["-0.03"] = 0.05155,
		["-0.04"] = 0.05050,
		["-0.05"] = 0.04947,
		["-0.06"] = 0.04846,
		["-0.07"] = 0.04746,
		["-0.08"] = 0.04648,
		["-0.09"] = 0.04551,

	},

	["-1.5"] = {

		["-0.00"] = 0.06681,
		["-0.01"] = 0.06552,
		["-0.02"] = 0.06426,
		["-0.03"] = 0.06301,
		["-0.04"] = 0.06178,
		["-0.05"] = 0.06057,
		["-0.06"] = 0.05938,
		["-0.07"] = 0.05821,
		["-0.08"] = 0.05705,
		["-0.09"] = 0.05592,

	},

	["-1.4"] = {

		["-0.00"] = 0.08076,
		["-0.01"] = 0.07927,
		["-0.02"] = 0.07780,
		["-0.03"] = 0.07636,
		["-0.04"] = 0.07493,
		["-0.05"] = 0.07353,
		["-0.06"] = 0.07215,
		["-0.07"] = 0.07078,
		["-0.08"] = 0.06944,
		["-0.09"] = 0.06811,

	},

	["-1.3"] = {

		["-0.00"] = 0.09680,
		["-0.01"] = 0.09510,
		["-0.02"] = 0.09342,
		["-0.03"] = 0.09176,
		["-0.04"] = 0.09012,
		["-0.05"] = 0.08851,
		["-0.06"] = 0.08692,
		["-0.07"] = 0.08534,
		["-0.08"] = 0.08379,
		["-0.09"] = 0.08226,

	},

	["-1.2"] = {

		["-0.00"] = 0.11507,
		["-0.01"] = 0.11314,
		["-0.02"] = 0.11123,
		["-0.03"] = 0.10935,
		["-0.04"] = 0.10749,
		["-0.05"] = 0.10565,
		["-0.06"] = 0.10383,
		["-0.07"] = 0.10204,
		["-0.08"] = 0.10027,
		["-0.09"] = 0.09853,

	},

	["-1.1"] = {

		["-0.00"] = 0.13567,
		["-0.01"] = 0.13350,
		["-0.02"] = 0.13136,
		["-0.03"] = 0.12924,
		["-0.04"] = 0.12714,
		["-0.05"] = 0.12507,
		["-0.06"] = 0.12302,
		["-0.07"] = 0.12100,
		["-0.08"] = 0.11900,
		["-0.09"] = 0.11702,

	},

	["-1.0"] = {

		["-0.00"] = 0.15866,
		["-0.01"] = 0.15625,
		["-0.02"] = 0.15386,
		["-0.03"] = 0.15151,
		["-0.04"] = 0.14917,
		["-0.05"] = 0.14686,
		["-0.06"] = 0.14457,
		["-0.07"] = 0.14231,
		["-0.08"] = 0.14007,
		["-0.09"] = 0.13786,

	},

	["-0.9"] = {

		["-0.00"] = 0.18406,
		["-0.01"] = 0.18141,
		["-0.02"] = 0.17879,
		["-0.03"] = 0.17619,
		["-0.04"] = 0.17361,
		["-0.05"] = 0.17106,
		["-0.06"] = 0.16853,
		["-0.07"] = 0.16602,
		["-0.08"] = 0.16354,
		["-0.09"] = 0.16109,

	},

	["-0.8"] = {

		["-0.00"] = 0.21186,
		["-0.01"] = 0.20897,
		["-0.02"] = 0.20611,
		["-0.03"] = 0.20327,
		["-0.04"] = 0.20045,
		["-0.05"] = 0.19766,
		["-0.06"] = 0.19489,
		["-0.07"] = 0.19215,
		["-0.08"] = 0.18943,
		["-0.09"] = 0.18673,

	},

	["-0.7"] = {

		["-0.00"] = 0.24196,
		["-0.01"] = 0.23885,
		["-0.02"] = 0.23576,
		["-0.03"] = 0.23270,
		["-0.04"] = 0.22965,
		["-0.05"] = 0.22663,
		["-0.06"] = 0.22363,
		["-0.07"] = 0.22065,
		["-0.08"] = 0.21770,
		["-0.09"] = 0.21476,
	},

	["-0.6"] = {

		["-0.00"] = 0.27425,
		["-0.01"] = 0.27093,
		["-0.02"] = 0.26763,
		["-0.03"] = 0.26435,
		["-0.04"] = 0.26109,
		["-0.05"] = 0.25785,
		["-0.06"] = 0.25463,
		["-0.07"] = 0.25143,
		["-0.08"] = 0.24825,
		["-0.09"] = 0.24510,
	},

	["-0.5"] = {

		["-0.00"] = 0.30854,
		["-0.01"] = 0.30503,
		["-0.02"] = 0.30153,
		["-0.03"] = 0.29806,
		["-0.04"] = 0.29460,
		["-0.05"] = 0.29116,
		["-0.06"] = 0.28774,
		["-0.07"] = 0.28434,
		["-0.08"] = 0.28096,
		["-0.09"] = 0.27760,
	},

	["-0.4"] = {

		["-0.00"] = 0.34458,
		["-0.01"] = 0.34090,
		["-0.02"] = 0.33724,
		["-0.03"] = 0.33360,
		["-0.04"] = 0.32997,
		["-0.05"] = 0.32636,
		["-0.06"] = 0.32276,
		["-0.07"] = 0.31918,
		["-0.08"] = 0.31561,
		["-0.09"] = 0.31207,
	},

	["-0.3"] = {

		["-0.00"] = 0.38209,
		["-0.01"] = 0.37828,
		["-0.02"] = 0.37448,
		["-0.03"] = 0.37070,
		["-0.04"] = 0.36693,
		["-0.05"] = 0.36317,
		["-0.06"] = 0.35942,
		["-0.07"] = 0.35569,
		["-0.08"] = 0.35197,
		["-0.09"] = 0.34827,
	},

	["-0.2"] = {

		["-0.00"] = 0.42074,
		["-0.01"] = 0.41683,
		["-0.02"] = 0.41294,
		["-0.03"] = 0.40905,
		["-0.04"] = 0.40517,
		["-0.05"] = 0.40129,
		["-0.06"] = 0.39743,
		["-0.07"] = 0.39358,
		["-0.08"] = 0.38974,
		["-0.09"] = 0.38591,
	},

	["-0.1"] = {

		["-0.00"] = 0.46017,
		["-0.01"] = 0.45620,
		["-0.02"] = 0.45224,
		["-0.03"] = 0.44828,
		["-0.04"] = 0.44433,
		["-0.05"] = 0.44038,
		["-0.06"] = 0.43644,
		["-0.07"] = 0.43251,
		["-0.08"] = 0.42858,
		["-0.09"] = 0.42465,
	},

	["-0.0"] = {

		["-0.00"] = 0.50000,
		["-0.01"] = 0.49601,
		["-0.02"] = 0.49202,
		["-0.03"] = 0.48803,
		["-0.04"] = 0.48405,
		["-0.05"] = 0.48006,
		["-0.06"] = 0.47608,
		["-0.07"] = 0.47210,
		["-0.08"] = 0.46812,
		["-0.09"] = 0.46414,

	},
	
	["0.0"] = { --There is a non-negative version of the minus zero value. Hence, this is created to avoid bugs.

		["-0.00"] = 0.50000,
		["-0.01"] = 0.49601,
		["-0.02"] = 0.49202,
		["-0.03"] = 0.48803,
		["-0.04"] = 0.48405,
		["-0.05"] = 0.48006,
		["-0.06"] = 0.47608,
		["-0.07"] = 0.47210,
		["-0.08"] = 0.46812,
		["-0.09"] = 0.46414,

	},

}

local cachedRowValueArray = {}

for k in pairs(zTable) do table.insert(cachedRowValueArray, tonumber(k)) end

table.sort(cachedRowValueArray)

local rowStringFormat = "%.1f"

local columnStringFormat = "%.2f"

local function forceNegative(value)
	
	if (value <= 0) then return value end
	
	return -value
	
end

function zTableFunction:getStandardNormalCumulativeDistributionFunction(zValue)

	local rowStringFormat = rowStringFormat

	local columnStringFormat = columnStringFormat

	local stringFormatFunction = string.format

	local isPositive = (zValue > 0)

	local finalZValue = (isPositive and -zValue) or zValue

	local clampedZValue = math.clamp(finalZValue, -3.9, 0)

	local rowValue = math.floor(clampedZValue * 10) / 10

	local columnValue = rowValue - finalZValue

	local lowerColumnValue = math.floor(columnValue * 100) / 100

	local upperColumnValue = lowerColumnValue - 0.01
	
	local lowerRowValue
	
	local upperRowValue
	
	if (lowerColumnValue <= -0.1) then
		
		lowerColumnValue = lowerColumnValue + 0.1
		
		lowerRowValue = rowValue - 0.1
		
	else
		
		lowerRowValue = rowValue
		
	end
	
	if (upperColumnValue <= -0.1) then
		
		upperColumnValue = upperColumnValue + 0.1
		
		upperRowValue = rowValue - 0.1
		
	else

		upperRowValue = rowValue
		
	end

	local lowerColumnString = stringFormatFunction(columnStringFormat, lowerColumnValue) -- Can go to -0.1, so we need to promote the row table.

	local upperColumnString = stringFormatFunction(columnStringFormat, upperColumnValue) -- Can go to -0.11, so we need to promote the row table.
	
	local lowerRowString = stringFormatFunction(rowStringFormat, lowerRowValue)
	
	local upperRowString = stringFormatFunction(rowStringFormat, upperRowValue)
	
	local lowerRowTable = zTable[lowerRowString]

	local upperRowTable = zTable[upperRowString]

	local lowerCumulativeDistributionFunctionValue = lowerRowTable[lowerColumnString]

	local upperCumulativeDistributionFunctionValue = upperRowTable[upperColumnString]

	if (not lowerCumulativeDistributionFunctionValue) then return upperCumulativeDistributionFunctionValue end

	if (not upperCumulativeDistributionFunctionValue) then return lowerCumulativeDistributionFunctionValue end

	local fraction = (columnValue - lowerColumnValue) / (upperColumnValue - lowerColumnValue)

	local cumulativeDistributionFunctionValue = lowerCumulativeDistributionFunctionValue + (upperCumulativeDistributionFunctionValue - lowerCumulativeDistributionFunctionValue) * fraction

	if (isPositive) then cumulativeDistributionFunctionValue = 1 - cumulativeDistributionFunctionValue end

	return cumulativeDistributionFunctionValue

end

function zTableFunction:getStandardNormalInverseCumulativeDistributionFunction(probability)

	local rowStringFormat = rowStringFormat

	local columnStringFormat = columnStringFormat

	local stringFormatFunction = string.format

	local isFlipped = (probability > 0.5)

	local finalProbability = (isFlipped and (1 - probability)) or probability

	local clampedProbability = math.clamp(finalProbability, 0.00005, 0.5)

	local closestZValue

	local rowString

	local rowTable

	local columnValueArray

	local columnValue1

	local columnValue2

	local probabilityValue1

	local probabilityValue2

	local fraction

	local closestZValue

	for _, rowValue in ipairs(cachedRowValueArray) do

		rowString = stringFormatFunction(rowStringFormat, rowValue)

		rowTable = zTable[rowString]

		columnValueArray = {}

		for k in pairs(rowTable) do table.insert(columnValueArray, tonumber(k)) end

		table.sort(columnValueArray)

		for i = 1, #columnValueArray - 1 do

			columnValue1 = columnValueArray[i]

			columnValue2 = columnValueArray[i + 1]

			probabilityValue1 = rowTable[stringFormatFunction(columnStringFormat, columnValue1)]

			probabilityValue2 = rowTable[stringFormatFunction(columnStringFormat, columnValue2)]

			if (clampedProbability >= probabilityValue1) and (clampedProbability <= probabilityValue2) then

				fraction = (clampedProbability - probabilityValue1) / (probabilityValue2 - probabilityValue1)

				closestZValue = rowValue - (columnValue1 + (fraction * (columnValue2 - columnValue1)))

				break

			end

		end

		if (closestZValue) then break end

	end

	if (isFlipped) and (closestZValue) then closestZValue = -closestZValue end

	return closestZValue

end

return zTableFunction
